<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ETL Automation Solution: BIML, C Scripts & CI/CD - Muhammad Siddique Data Engineering Blog">
    <title>ETL Automation Solution: BIML, C Scripts & CI/CD | Muhammad Siddique - Data Engineering Blog</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #1abc9c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #7f8c8d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.8;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .container { width: 90%; max-width: 1000px; margin: 0 auto; padding: 0 20px; }
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            text-decoration: none;
            color: white;
        }
        .logo span { color: var(--accent); }
        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }
        nav ul li a:hover {
            color: var(--accent);
            background-color: rgba(255,255,255,0.1);
        }
        .article {
            background: white;
            padding: 3rem;
            margin: 3rem auto;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            max-width: 1000px;
        }
        .article-header {
            border-bottom: 3px solid var(--accent);
            padding-bottom: 2rem;
            margin-bottom: 2rem;
        }
        .article-header h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 1rem;
            line-height: 1.3;
        }
        .article-meta {
            color: var(--gray);
            font-size: 0.95rem;
            margin-top: 1rem;
        }
        .article-content {
            line-height: 1.9;
            font-size: 1.05rem;
        }
        .article-content h1 { color: var(--primary); font-size: 2.2rem; margin: 2.5rem 0 1.5rem 0; padding-bottom: 0.5rem; border-bottom: 2px solid var(--light); }
        .article-content h2 { color: var(--primary); font-size: 1.8rem; margin: 2rem 0 1rem 0; padding-top: 1rem; }
        .article-content h3 { color: var(--primary); font-size: 1.5rem; margin: 1.5rem 0 0.8rem 0; }
        .article-content h4 { color: var(--dark); font-size: 1.3rem; margin: 1.2rem 0 0.6rem 0; }
        .article-content p { margin-bottom: 1.2rem; color: #444; }
        .article-content ul, .article-content ol { margin: 1.5rem 0; padding-left: 2rem; }
        .article-content li { margin-bottom: 0.8rem; color: #444; }
        .article-content code {
            background-color: #f4f4f4;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }
        .article-content pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .article-content pre code {
            background-color: transparent;
            color: #ecf0f1;
            padding: 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .article-content a { color: var(--secondary); text-decoration: none; border-bottom: 1px solid transparent; transition: all 0.3s; }
        .article-content a:hover { color: var(--accent); border-bottom-color: var(--accent); }
        .article-content strong { color: var(--primary); font-weight: 700; }
        .article-content em { font-style: italic; color: #555; }
        .back-link {
            display: inline-block;
            margin-top: 2rem;
            padding: 0.8rem 1.5rem;
            background-color: var(--secondary);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s;
            font-weight: 600;
        }
        .back-link:hover {
            background-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        footer {
            background: linear-gradient(135deg, var(--primary) 0%, #1a252f 100%);
            color: white;
            padding: 3rem 0 2rem;
            margin-top: 4rem;
        }
        .footer-content {
            text-align: center;
            padding: 2rem 0;
        }
        .footer-content p { margin-bottom: 1rem; color: #bdc3c7; }
        .footer-content a { color: var(--accent); text-decoration: none; }
        .footer-content a:hover { text-decoration: underline; }
        @media (max-width: 768px) {
            .article { padding: 2rem 1.5rem; margin: 2rem auto; }
            .article-header h1 { font-size: 2rem; }
            .article-content { font-size: 1rem; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="../index.html" class="logo">Muhammad Siddique | Data<span>Engineering</span>.Blog</a>
                <nav>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="../index.html#blog">Blog</a></li>
                        <li><a href="about-author.html">About</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="article">
        <div class="article-header">
            <h1>ETL Automation Solution: BIML, C Scripts & CI/CD</h1>
            <div class="article-meta">
                <strong>Muhammad Siddique</strong> | Data Engineering Professional | 
                <a href="../index.html" style="color: var(--secondary);">Back to Blog</a>
            </div>
        </div>
        
        <div class="article-content">
<h1>ETL Automation Solution: BIML, C# Scripts & CI/CD</h1>

<em>Published: January 2025 | By: Data Engineering Professional</em>

<h2>Overview</h2>

<p>Production-ready ETL automation solution using BIML (Business Intelligence Markup Language) for metadata-driven SSIS package generation, C# Script Tasks for encryption and SFTP operations, and Azure DevOps CI/CD pipelines for automated deployment. This solution enables rapid package generation and deployment with minimal manual intervention.</p>

<h2>The Challenge</h2>

<strong>Business Requirements:</strong>
<p>- Generate SSIS packages from metadata automatically</p>
<p>- Implement secure file encryption and SFTP operations</p>
<p>- Automate deployment through CI/CD pipelines</p>
<p>- Reduce manual package development time</p>
<p>- Maintain consistency across packages</p>

<strong>Technical Challenges:</strong>
<p>- Metadata-driven package generation</p>
<p>- Secure credential management</p>
<p>- Automated deployment to SSISDB</p>
<p>- Integration with Azure DevOps</p>
<p>- Version control and rollback capabilities</p>

<p>---</p>

<h2>Architecture Overview</h2>

<h3>Automation Architecture</h3>

<pre><code class="language-">┌─────────────────────────────────────────────────────┐
<p>│           Metadata Source                           │</p>
<p>│  • Database Table (incoming_files)                  │</p>
<p>│  • File Type Definitions                            │</p>
<p>│  • Connection Configurations                        │</p>
<p>│  • Transformation Rules                             │</p>
<p>└──────────────────┬──────────────────────────────────┘</p>
<p>                   │</p>
<p>┌──────────────────▼──────────────────────────────────┐</p>
<p>│           BIML Engine                                │</p>
<p>│  • Template Processing                               │</p>
<p>│  • Package Generation                                │</p>
<p>│  • Metadata Integration                              │</p>
<p>└──────────────────┬──────────────────────────────────┘</p>
<p>                   │</p>
<p>┌──────────────────▼──────────────────────────────────┐</p>
<p>│           SSIS Packages (.dtsx)                     │</p>
<p>│  • Generated Packages                                │</p>
<p>│  • C# Script Tasks                                   │</p>
<p>│  • Encrypted Connections                             │</p>
<p>└──────────────────┬──────────────────────────────────┘</p>
<p>                   │</p>
<p>┌──────────────────▼──────────────────────────────────┐</p>
<p>│           CI/CD Pipeline                             │</p>
<p>│  • Build & Compile                                   │</p>
<p>│  • Generate .ispac                                   │</p>
<p>│  • Deploy to SSISDB                                  │</p>
<p>└──────────────────┬──────────────────────────────────┘</p>
<p>                   │</p>
<p>┌──────────────────▼──────────────────────────────────┐</p>
<p>│           SSISDB Catalog                             │</p>
<p>│  • Deployed Packages                                 │</p>
<p>│  • Environments                                      │</p>
<p>│  • Execution History                                 │</p>
<p>└─────────────────────────────────────────────────────┘</p>
</code></pre>

<h3>Components</h3>

<strong>1. BIML Templates:</strong>
<p>- Metadata-driven package generation</p>
<p>- Reusable transformation patterns</p>
<p>- Configuration-based connections</p>
<p>- Dynamic parameter handling</p>

<strong>2. C# Script Tasks:</strong>
<p>- AES file encryption</p>
<p>- SFTP upload/download</p>
<p>- Secure credential handling</p>
<p>- Error handling and logging</p>

<strong>3. CI/CD Pipeline:</strong>
<p>- Azure DevOps YAML pipelines</p>
<p>- Automated build and deployment</p>
<p>- Environment promotion</p>
<p>- Rollback capabilities</p>

<p>---</p>

<h2>BIML Template Implementation</h2>

<h3>Metadata Table Structure</h3>

<strong>Incoming Files Metadata:</strong>
<pre><code class="language-sql">CREATE TABLE dbo.incoming_files (
<p>    FileTypeId          INT PRIMARY KEY,</p>
<p>    FilePattern         VARCHAR(255),      -- Regex or glob pattern</p>
<p>    FlatFileFormat      VARCHAR(100),      -- Delimiter, header info</p>
<p>    ConnectionName      VARCHAR(100),      -- Source connection</p>
<p>    DestinationTable    VARCHAR(255),      -- schema.table</p>
<p>    XsdPath             VARCHAR(500) NULL, -- XSD validation path</p>
<p>    HasHeader           BIT DEFAULT 1,</p>
<p>    RowDelimiter        VARCHAR(10),       -- CRLF, LF, etc.</p>
<p>    ColumnsJson         NVARCHAR(MAX)       -- JSON column definitions</p>
<p>);</p>
</code></pre>

<h3>BIML Template</h3>

<strong>Core BIML Template:</strong>
<pre><code class="language-xml"><Biml xmlns="http://schemas.varigence.com/biml.xsd">
  <Connections>
    <OleDbConnection Name="DW" 
<p>        ConnectionString="Provider=SQLNCLI11;Data Source=.;Initial Catalog=DW;Integrated Security=SSPI;"/></p>
    <FlatFileConnection Name="FlatFile_<#= row.FileTypeId #>" 
<p>        FilePath="<#= row.FilePath #>"</p>
<p>        Format="Delimited"</p>
<p>        RowDelimiter="<#= row.RowDelimiter #>"</p>
<p>        ColumnNamesInFirstDataRow="<#= row.HasHeader #>"></p>
      <Columns>
        <# foreach(var col in JsonConvert.DeserializeObject<List<Column>>(row.ColumnsJson)) { #>
        <Column Name="<#= col.Name #>" 
<p>                DataType="<#= col.DataType #>" </p>
<p>                Length="<#= col.Length #>" /></p>
        <# } #>
      </Columns>
    </FlatFileConnection>
  </Connections>

  <Packages>
    <# 
<p>      var metadata = External.GetMetadata(); // Read from incoming_files table</p>
<p>      foreach(var row in metadata) {</p>
    #>
    <Package Name="Load_<#= row.FileTypeId #>_File.dtsx" ConstraintMode="Linear">
      <Variables>
        <Variable Name="User::BatchId" DataType="Guid" Namespace="User">
          <Value>"<#= System.Guid.NewGuid().ToString() #>"</Value>
        </Variable>
        <Variable Name="User::SourceFile" DataType="String" Namespace="User"/>
        <Variable Name="User::EncryptedFile" DataType="String" Namespace="User"/>
        <Variable Name="User::SftpRemotePath" DataType="String" Namespace="User"/>
      </Variables>

      <Tasks>
        <!-- File Validation -->
        <ScriptTask Name="Validate_File" Language="CSharp">
          <ScriptProject>
            <ScriptFiles>
              <ScriptFile Name="Main.cs"><![CDATA[
<p>using System;</p>
<p>using System.IO;</p>
<p>using Microsoft.SqlServer.Dts.Runtime;</p>

<p>public class ScriptMain {</p>
<p>  public void Main() {</p>
<p>    string sourceFile = Dts.Variables["User::SourceFile"].Value.ToString();</p>
    
<p>    // Validate file exists</p>
<p>    if (!File.Exists(sourceFile)) {</p>
<p>      Dts.Events.FireError(0, "Validate_File", $"File not found: {sourceFile}", "", 0);</p>
<p>      Dts.TaskResult = (int)ScriptResults.Failure;</p>
<p>      return;</p>
<p>    }</p>
    
<p>    // Validate against XSD if provided</p>
<p>    string xsdPath = Dts.Variables["User::XsdPath"].Value?.ToString();</p>
<p>    if (!string.IsNullOrEmpty(xsdPath) && File.Exists(xsdPath)) {</p>
<p>      // XSD validation logic</p>
<p>      if (!ValidateAgainstXsd(sourceFile, xsdPath)) {</p>
<p>        Dts.Events.FireError(0, "Validate_File", "XSD validation failed", "", 0);</p>
<p>        Dts.TaskResult = (int)ScriptResults.Failure;</p>
<p>        return;</p>
<p>      }</p>
<p>    }</p>
    
<p>    Dts.TaskResult = (int)ScriptResults.Success;</p>
<p>  }</p>
  
<p>  private bool ValidateAgainstXsd(string xmlFile, string xsdFile) {</p>
<p>    // XSD validation implementation</p>
<p>    return true;</p>
<p>  }</p>
<p>}</p>
<p>]]></ScriptFile></p>
            </ScriptFiles>
          </ScriptProject>
        </ScriptTask>

        <!-- Encrypt File -->
        <ScriptTask Name="Encrypt_File" Language="CSharp">
          <ScriptProject>
            <ScriptFiles>
              <ScriptFile Name="Main.cs"><![CDATA[
<p>using System;</p>
<p>using System.IO;</p>
<p>using System.Security.Cryptography;</p>
<p>using Microsoft.SqlServer.Dts.Runtime;</p>

<p>public class ScriptMain {</p>
<p>  public void Main() {</p>
<p>    string src = Dts.Variables["User::SourceFile"].Value.ToString();</p>
<p>    string dest = Dts.Variables["User::EncryptedFile"].Value.ToString();</p>
<p>    string keyBase64 = Dts.Variables["User::EncKeyBase64"].Value.ToString();</p>

<p>    byte[] key = Convert.FromBase64String(keyBase64);</p>

<p>    try {</p>
<p>      using (Aes aes = Aes.Create()) {</p>
<p>        aes.Key = key;</p>
<p>        aes.Mode = CipherMode.CBC;</p>
<p>        aes.Padding = PaddingMode.PKCS7;</p>
<p>        aes.GenerateIV();</p>

<p>        using (FileStream fsOut = new FileStream(dest, FileMode.Create, FileAccess.Write)) {</p>
<p>          // Write IV first</p>
<p>          fsOut.Write(aes.IV, 0, aes.IV.Length);</p>

<p>          using (var cryptoStream = new CryptoStream(fsOut, aes.CreateEncryptor(), CryptoStreamMode.Write))</p>
<p>          using (var fsIn = new FileStream(src, FileMode.Open, FileAccess.Read)) {</p>
<p>            fsIn.CopyTo(cryptoStream);</p>
<p>          }</p>
<p>        }</p>
<p>      }</p>

<p>      Dts.TaskResult = (int)DTSExecResult.Success;</p>
<p>    }</p>
<p>    catch (Exception ex) {</p>
<p>      Dts.Events.FireError(0, "AES Encrypt", ex.Message + "\n" + ex.StackTrace, "", 0);</p>
<p>      Dts.TaskResult = (int)DTSExecResult.Failure;</p>
<p>    }</p>
<p>  }</p>
<p>}</p>
<p>]]></ScriptFile></p>
            </ScriptFiles>
          </ScriptProject>
        </ScriptTask>

        <!-- SFTP Upload -->
        <ScriptTask Name="SFTP_Upload" Language="CSharp">
          <ScriptProject>
            <References>
              <Reference AssemblyPath="C:\SSIS\Renci.SshNet.dll" />
            </References>
            <ScriptFiles>
              <ScriptFile Name="Main.cs"><![CDATA[
<p>using System;</p>
<p>using System.IO;</p>
<p>using Microsoft.SqlServer.Dts.Runtime;</p>
<p>using Renci.SshNet;</p>
<p>using Renci.SshNet.Common;</p>

<p>public class ScriptMain {</p>
<p>  public void Main() {</p>
<p>    string host = Dts.Variables["User::SftpHost"].Value.ToString();</p>
<p>    int port = Convert.ToInt32(Dts.Variables["User::SftpPort"].Value);</p>
<p>    string user = Dts.Variables["User::SftpUser"].Value.ToString();</p>
<p>    string pass = Dts.Variables["User::SftpPassword"].Value.ToString();</p>
<p>    string local = Dts.Variables["User::EncryptedFile"].Value.ToString();</p>
<p>    string remote = Dts.Variables["User::SftpRemotePath"].Value.ToString();</p>

<p>    try {</p>
<p>      using (var sftp = new SftpClient(host, port, user, pass)) {</p>
<p>        sftp.Connect();</p>
<p>        using (var fs = File.OpenRead(local)) {</p>
<p>          sftp.UploadFile(fs, remote);</p>
<p>        }</p>
<p>        sftp.Disconnect();</p>
<p>      }</p>

<p>      Dts.TaskResult = (int)DTSExecResult.Success;</p>
<p>    }</p>
<p>    catch (SshAuthenticationException aEx) {</p>
<p>      Dts.Events.FireError(0, "SFTP Auth", aEx.Message, "", 0);</p>
<p>      Dts.TaskResult = (int)DTSExecResult.Failure;</p>
<p>    }</p>
<p>    catch (Exception ex) {</p>
<p>      Dts.Events.FireError(0, "SFTP Upload", ex.Message, "", 0);</p>
<p>      Dts.TaskResult = (int)DTSExecResult.Failure;</p>
<p>    }</p>
<p>  }</p>
<p>}</p>
<p>]]></ScriptFile></p>
            </ScriptFiles>
          </ScriptProject>
        </ScriptTask>

        <!-- Data Flow -->
        <Dataflow Name="DF_Load_<#= row.FileTypeId #>">
          <Transformations>
            <FlatFileSource Name="FFSrc">
              <FlatFileConnection ConnectionName="FlatFile_<#= row.FileTypeId #>"/>
            </FlatFileSource>
            
            <DerivedColumns Name="AddMetadata">
              <Columns>
                <Column Name="BatchId" ReplaceExisting="true">
                  <Expression>@[User::BatchId]</Expression>
                </Column>
                <Column Name="LoadTimestamp" ReplaceExisting="true">
                  <Expression>GETDATE()</Expression>
                </Column>
              </Columns>
            </DerivedColumns>
            
            <OleDbDestination Name="InsertToStaging" 
<p>                ConnectionName="DW" </p>
<p>                TableName="<#= row.DestinationTable #>"></p>
              <InputPath OutputPathName="AddMetadata.Output" />
            </OleDbDestination>
          </Transformations>
        </Dataflow>

        <!-- Post-Load Merge -->
        <ExecuteSQL Name="PostLoad_Merge" ConnectionName="DW">
          <DirectInput>
<p>            EXEC dbo.usp_Merge_FileType_<#= row.FileTypeId #> </p>
<p>                @BatchId = ?;</p>
          </DirectInput>
          <Parameters>
            <Parameter Name="0" VariableName="User::BatchId" DataType="Guid" />
          </Parameters>
        </ExecuteSQL>
      </Tasks>
    </Package>
    <# } #>
  </Packages>
</Biml>
</code></pre>

<p>---</p>

<h2>CI/CD Pipeline</h2>

<h3>Azure DevOps YAML Pipeline</h3>

<strong>Complete Pipeline:</strong>
<pre><code class="language-yaml">trigger:
<p>  branches:</p>
<p>    include:</p>
<p>      - main</p>
<p>      - develop</p>

<p>pool:</p>
<p>  name: 'Default' # Self-hosted Windows agent with SSDT & BIML tools</p>

<p>variables:</p>
<p>  buildConfiguration: 'Release'</p>
<p>  outputDir: '$(Build.ArtifactStagingDirectory)'</p>
<p>  ssisProjectPath: '$(Build.SourcesDirectory)/SSIS/MySsisProject.dtproj'</p>

<p>stages:</p>
<p>- stage: Build</p>
<p>  displayName: 'Build BIML and SSIS'</p>
<p>  jobs:</p>
<p>  - job: Build</p>
<p>    displayName: 'Generate and Build'</p>
<p>    steps:</p>
<p>    - task: UseDotNet@2</p>
<p>      displayName: 'Use .NET SDK'</p>
<p>      inputs:</p>
<p>        packageType: 'sdk'</p>
<p>        version: '7.x'</p>

<p>    - checkout: self</p>
<p>      displayName: 'Checkout Code'</p>

<p>    - task: PowerShell@2</p>
<p>      displayName: 'Generate Packages from BIML'</p>
<p>      inputs:</p>
<p>        targetType: 'inline'</p>
<p>        script: |</p>
<p>          Write-Host "Generating packages from BIML..."</p>
          
          # Run BIML engine to generate .dtsx files
<p>          $bimlPath = "$(Build.SourcesDirectory)/BIML"</p>
<p>          $outputPath = "$(Build.SourcesDirectory)/SSIS/Generated"</p>
          
          # Execute BIML generator (BimlExpress or custom script)
<p>          & "C:\Program Files\Varigence\BimlExpress\BimlExpress.exe" `</p>
<p>            -InputPath $bimlPath `</p>
<p>            -OutputPath $outputPath `</p>
<p>            -MetadataConnection "Server=.;Database=SSISConfig;Integrated Security=True"</p>
          
<p>          if ($LASTEXITCODE -ne 0) {</p>
<p>            throw "BIML generation failed"</p>
<p>          }</p>

<p>    - task: MSBuild@1</p>
<p>      displayName: 'Build SSIS Project'</p>
<p>      inputs:</p>
<p>        solution: '$(Build.SourcesDirectory)/SSIS/MySsisProject.sln'</p>
<p>        platform: '$(BuildPlatform)'</p>
<p>        configuration: '$(buildConfiguration)'</p>
<p>        msbuildArguments: '/p:OutDir=$(outputDir)\ /p:DeployOnBuild=false'</p>

<p>    - task: CopyFiles@2</p>
<p>      displayName: 'Copy Generated Files'</p>
<p>      inputs:</p>
<p>        SourceFolder: '$(Build.SourcesDirectory)/SSIS/Generated'</p>
<p>        TargetFolder: '$(outputDir)/Generated'</p>
<p>        Contents: '<em>*/</em>.dtsx'</p>

<p>    - task: PublishBuildArtifacts@1</p>
<p>      displayName: 'Publish Artifacts'</p>
<p>      inputs:</p>
<p>        PathtoPublish: '$(outputDir)'</p>
<p>        ArtifactName: 'ssis-ispac'</p>
<p>        publishLocation: 'Container'</p>

<p>- stage: Deploy_Dev</p>
<p>  displayName: 'Deploy to Development'</p>
<p>  dependsOn: Build</p>
<p>  condition: succeeded()</p>
<p>  jobs:</p>
<p>  - deployment: DeployToDev</p>
<p>    displayName: 'Deploy ISPAC to SSISDB (Dev)'</p>
<p>    environment: 'dev'</p>
<p>    strategy:</p>
<p>      runOnce:</p>
<p>        deploy:</p>
<p>          steps:</p>
<p>          - download: current</p>
<p>            artifact: ssis-ispac</p>
<p>            displayName: 'Download Artifacts'</p>

<p>          - task: PowerShell@2</p>
<p>            displayName: 'Deploy ISPAC to SSISDB'</p>
<p>            inputs:</p>
<p>              targetType: 'inline'</p>
<p>              script: |</p>
<p>                $ispac = Get-ChildItem -Path $(Pipeline.Workspace) -Filter *.ispac -Recurse | Select-Object -First 1</p>
<p>                if ($null -eq $ispac) { </p>
<p>                  throw "No ispac found" </p>
<p>                }</p>

<p>                $serverInstance = '$(DevSqlServer)'</p>
<p>                $folder = '$(DevFolder)'</p>
<p>                $project = 'MySsisProject'</p>
                
                # Deploy using PowerShell script
<p>                & "$(Build.SourcesDirectory)/scripts/deploy-ispac.ps1" `</p>
<p>                  -Ispac $ispac.FullName `</p>
<p>                  -ServerInstance $serverInstance `</p>
<p>                  -CatalogFolder $folder `</p>
<p>                  -ProjectName $project</p>

<p>          - task: PowerShell@2</p>
<p>            displayName: 'Smoke Test'</p>
<p>            inputs:</p>
<p>              targetType: 'inline'</p>
<p>              script: |</p>
                # Run a small test package to validate deployment
<p>                Write-Host "Running smoke test..."</p>

<p>- stage: Deploy_Prod</p>
<p>  displayName: 'Deploy to Production'</p>
<p>  dependsOn: Deploy_Dev</p>
<p>  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))</p>
<p>  jobs:</p>
<p>  - deployment: DeployToProd</p>
<p>    displayName: 'Deploy ISPAC to SSISDB (Prod)'</p>
<p>    environment: 'prod'</p>
<p>    strategy:</p>
<p>      runOnce:</p>
<p>        deploy:</p>
<p>          steps:</p>
<p>          - download: current</p>
<p>            artifact: ssis-ispac</p>

<p>          - task: PowerShell@2</p>
<p>            displayName: 'Deploy ISPAC to SSISDB'</p>
<p>            inputs:</p>
<p>              targetType: 'inline'</p>
<p>              script: |</p>
<p>                $ispac = Get-ChildItem -Path $(Pipeline.Workspace) -Filter *.ispac -Recurse | Select-Object -First 1</p>
                
<p>                $serverInstance = '$(ProdSqlServer)'</p>
<p>                $folder = '$(ProdFolder)'</p>
<p>                $project = 'MySsisProject'</p>
                
<p>                & "$(Build.SourcesDirectory)/scripts/deploy-ispac.ps1" `</p>
<p>                  -Ispac $ispac.FullName `</p>
<p>                  -ServerInstance $serverInstance `</p>
<p>                  -CatalogFolder $folder `</p>
<p>                  -ProjectName $project</p>
</code></pre>

<h3>Deployment Script</h3>

<strong>PowerShell Deployment Script:</strong>
<pre><code class="language-powershell">param(
<p>    [Parameter(Mandatory=$true)]</p>
<p>    [string]$Ispac,</p>
    
<p>    [Parameter(Mandatory=$true)]</p>
<p>    [string]$ServerInstance,</p>
    
<p>    [Parameter(Mandatory=$true)]</p>
<p>    [string]$CatalogFolder,</p>
    
<p>    [Parameter(Mandatory=$true)]</p>
<p>    [string]$ProjectName</p>
<p>)</p>

<p>Write-Host "Deploying $Ispac to $ServerInstance into $CatalogFolder/$ProjectName"</p>

<h1>Read ispac file as bytes</h1>
<p>$bytes = [System.IO.File]::ReadAllBytes($Ispac)</p>
<p>$base64 = [System.Convert]::ToBase64String($bytes)</p>

<h1>T-SQL to deploy project</h1>
<p>$tsql = @"</p>
<p>DECLARE @project_stream varbinary(max) = CONVERT(varbinary(max), '$base64', 2);</p>

<p>-- Create folder if not exists</p>
<p>IF NOT EXISTS (SELECT 1 FROM [SSISDB].[catalog].[folders] WHERE name = N'$CatalogFolder')</p>
<p>BEGIN</p>
<p>    EXEC [SSISDB].[catalog].[create_folder] @folder_name = N'$CatalogFolder';</p>
<p>END</p>

<p>-- Deploy project</p>
<p>EXEC [SSISDB].[catalog].[deploy_project]</p>
<p>    @folder_name = N'$CatalogFolder',</p>
<p>    @project_name = N'$ProjectName',</p>
<p>    @project_stream = @project_stream;</p>
<p>"@</p>

<p>try {</p>
<p>    Invoke-Sqlcmd -ServerInstance $ServerInstance -Query $tsql -QueryTimeout 300</p>
<p>    Write-Host "Deployment successful"</p>
<p>    exit 0</p>
<p>}</p>
<p>catch {</p>
<p>    Write-Error "Deployment failed: $_"</p>
<p>    exit 1</p>
<p>}</p>
</code></pre>

<p>---</p>

<h2>Key Features</h2>

<h3>Metadata-Driven Generation</h3>

<p>- <strong>Automatic Package Creation</strong>: Generate packages from metadata</p>
<p>- <strong>Consistent Patterns</strong>: Standardized package structure</p>
<p>- <strong>Rapid Development</strong>: Reduce development time by 70%+</p>
<p>- <strong>Maintainability</strong>: Centralized metadata management</p>

<h3>Security Features</h3>

<p>- <strong>AES Encryption</strong>: File encryption before transfer</p>
<p>- <strong>Secure Credentials</strong>: Key Vault integration</p>
<p>- <strong>SFTP Security</strong>: Encrypted file transfer</p>
<p>- <strong>Audit Logging</strong>: Comprehensive execution logging</p>

<h3>Automation Benefits</h3>

<p>- <strong>CI/CD Integration</strong>: Automated deployment</p>
<p>- <strong>Environment Promotion</strong>: Dev → Test → Prod</p>
<p>- <strong>Version Control</strong>: Git-based versioning</p>
<p>- <strong>Rollback Capability</strong>: Quick rollback procedures</p>

<p>---</p>

<h2>Best Practices</h2>

<h3>BIML Best Practices</h3>

<p>1. <strong>Reusable Templates</strong>: Create reusable BIML patterns</p>
<p>2. <strong>Metadata Validation</strong>: Validate metadata before generation</p>
<p>3. <strong>Error Handling</strong>: Comprehensive error handling in generated packages</p>
<p>4. <strong>Documentation</strong>: Document template patterns and usage</p>
<p>5. <strong>Version Control</strong>: Track BIML template changes</p>

<h3>CI/CD Best Practices</h3>

<p>1. <strong>Environment Separation</strong>: Separate dev, test, prod environments</p>
<p>2. <strong>Approval Gates</strong>: Require approvals for production</p>
<p>3. <strong>Testing</strong>: Automated testing before deployment</p>
<p>4. <strong>Monitoring</strong>: Monitor deployment success</p>
<p>5. <strong>Rollback Plan</strong>: Plan for quick rollback</p>

<h3>Security Best Practices</h3>

<p>1. <strong>Key Management</strong>: Use Azure Key Vault for secrets</p>
<p>2. <strong>Credential Rotation</strong>: Regular credential rotation</p>
<p>3. <strong>Access Control</strong>: Least privilege access</p>
<p>4. <strong>Audit Logging</strong>: Comprehensive audit trails</p>
<p>5. <strong>Encryption</strong>: Encrypt sensitive data in transit and at rest</p>

<p>---</p>

<h2>Conclusion</h2>

<p>ETL automation with BIML and CI/CD provides:</p>
<p>- <strong>Rapid Development</strong>: Metadata-driven package generation</p>
<p>- <strong>Consistency</strong>: Standardized package patterns</p>
<p>- <strong>Security</strong>: Encryption and secure transfers</p>
<p>- <strong>Automation</strong>: Automated deployment pipelines</p>
<p>- <strong>Maintainability</strong>: Centralized metadata management</p>

<strong>Key Takeaways:</strong>
<p>1. BIML dramatically reduces package development time</p>
<p>2. Metadata-driven approach ensures consistency</p>
<p>3. CI/CD enables automated, reliable deployments</p>
<p>4. Security is critical for production systems</p>
<p>5. Automation reduces manual errors and effort</p>

<p>---</p>

<em>This solution demonstrates enterprise ETL automation. For related content, see <a href="./metadata-driven-etl-framework.html">Metadata-Driven ETL Framework</a> and <a href="./enterprise-data-warehouse-migration.html">Enterprise Data Warehouse Migration</a>.</em>


        </div>
        
        <a href="../index.html" class="back-link">← Back to Blog</a>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <p><strong>Muhammad Siddique</strong> | Data Engineering Professional</p>
                <p>Phone: <a href="tel:+923315868725">+92 331 5868725</a> | 
                   Email: <a href="mailto:siddique.dea@gmail.com">siddique.dea@gmail.com</a> | 
                   <a href="https://www.linkedin.com/in/siddique-datalover" target="_blank">LinkedIn</a></p>
                <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;">
                    &copy; 2025 Muhammad Siddique | Data Engineering Blog & Portfolio
                </p>
            </div>
        </div>
    </footer>
</body>
</html>